import os, sys, Crypto
from Crypto.PublicKey import RSA
from Crypto.Util.number import long_to_bytes as l2b
from sympy import *
import gmpy2
import binascii
import base64

e = 65537

p0 = 8989369788677530953859800463566537523269300891380161088496152744815783466036747124226208560709810171755464634734683311566765579804377100028641164925635031733230329486284115263330008878980828887306992210871161025089197108423514074168002348645096841716549031567894409425215913785368201553951373838203801844569
p1 = 17978739577355061907719600927133075046538601782760322176992305489631566932073494248452417121419620343510929269469366623133531159608754200057282329851270063466460658972568230526660017757961657774613984421742322050178394216847028148336004697290193683433098063135788818850431827570736403107902747676407603689831
p2 = 35957479154710123815439201854266150093077203565520644353984610979263133864146988496904834242839240687021858538938733246267062319217508400114564659702540126932921317945136461053320035515923315549227968843484644100356788433694056296672009394580387366866196126271577637700863655141472806215805495352815207379879
p3 = 71914958309420247630878403708532300186154407131041288707969221958526267728293976993809668485678481374043717077877466492534124638435016800229129319405080253865842635890272922106640071031846631098455937686969288200713576867388112593344018789160774733732392252543155275401727310282945612431610990705630414759909
p4 = 143829916618840495261756807417064600372308814262082577415938443917052535456587953987619336971356962748087434155754932985068249276870033600458258638810160507731685271780545844213280142063693262196911875373938576401427153734776225186688037578321549467464784505086310550803454620565891224863221981411260829522569
p5 = 287659833237680990523513614834129200744617628524165154831876887834105070913175907975238673942713925496174868311509865970136498553740067200916517277620321015463370543561091688426560284127386524393823750747877152802854307469552450373376075156643098934929569010172621101606909241131782449726443962822521659045201
p6 = 575319666475361981047027229668258401489235257048330309663753775668210141826351815950477347885427850992349736623019731940272997107480134401833034555240642030926741087122183376853120568254773048787647501495754305605708614939104900746752150313286197869859138020345242203213818482263564899452887925645043318091471
p7 = 1150639332950723962094054459336516802978470514096660619327507551336420283652703631900954695770855701984699473246039463880545994214960268803666069110481284061853482174244366753706241136509546097575295002991508611211417229878209801493504300626572395739718276040690484406427636964527129798905775851290086636182963

n1 = int("51EFBD357CCB0810E114F651E3E8355BDFE25BD9EF6C6859E7493169801B3257DDADD8571BC7DC7F729A0E37AA414F6A8390084C36B97EDC478E4236AB3E83B79714E545516D82E2B62A4A98700003B35A392611B8C67858D75C00AB7B67529344CA2E3A060C1C1F814371E53B8D3560D716BF5375D04EE4D9EB95F01748128A968894501763B76D7C8992692A5B36D28775BAB41BB4C2AEA605EAF8025640EEC854E79AC9C7ACAEF163BFBD3266E0A8984461A534ACA9E703042266524CC059A8BC93BE754CADEA78E502F8783E3EDD2813A12E822784C02D1DD743C74C6B55CB50B7CDC35E00F3E7885594CDD0731A43C62BD7617889DDC890E603F763543B", 16)
n2 = int("51EFBD357CCB0810E114F651E3E8355BDFE25BD9EF6C6859E7493169801B3257DDADD8571BC7DC7F729A0E37AA414F6A8390084C36B97EDC478E4236AB3E83B79714E545516D82E2B62A4A98700003B35A392611B8C67858D75C00AB7B67529344CA2E3A060C1C1F814371E53B8D3560D716BF5375D04EE4D9EB95F017481B335C68E5213795E7433FE052BBF3189214D3E57FCACCFB833DD8C5306DCFEB00EF1EB5722E7241DCE87F54DD15A98EAC436B510E5B2922FA1D4A75942EA18CA166E20222CD193AFF95E231EF8F1F334DE980CFF5FF75F319C04020C41ED547D1367AA057C153E578F416C78414AC08EC73FBC27D72411416C140C6A9D16F356C49", 16)
n3 = int("51EFBD357CCB0810E114F651E3E8355BDFE25BD9EF6C6859E7493169801B3257DDADD8571BC7DC7F729A0E37AA414F6A8390084C36B97EDC478E4236AB3E83B79714E545516D82E2B62A4A98700003B35A392611B8C67858D75C00AB7B67529344CA2E3A060C1C1F814371E53B8D3560D716BF5375D04EE4D9EB95F017481C23AF65C12D6CCBE76CAF04990FF03056B671802488BE598B54FE688558B6ED76098A941DD9B24F6302DE224638142140F120742032495F9E5002AB484D75A1969D588C29B7A96F458F2C5784BF3E8946BE299B75EA74E2E6EDCDCE10C896F9531E77DF75B0C4D72CEA9D8572AB6E2E43AB7F76E760CFC87E358A8C02E784E32AD7", 16)
n4 = int("51EFBD357CCB0810E114F651E3E8355BDFE25BD9EF6C6859E7493169801B3257DDADD8571BC7DC7F729A0E37AA414F6A8390084C36B97EDC478E4236AB3E83B79714E545516D82E2B62A4A98700003B35A392611B8C67858D75C00AB7B67529344CA2E3A060C1C1F814371E53B8D3560D716BF5375D04EE4D9EB95F017481C8FE56235BADBCB2EFB3D1B52C6BF78EFCF2AE1CADD343136C3E0965D9993476AA1D967997D6ACBF0FF9D1D7FE4493AE0E42644D949BFF8D895EF8DE091E2C2FEBDC0A1D468A7FEC3FCDD3A8667655C923E32480E540E22AA8BA3107C2BEE4B7CFE231C5F4488430C623F81447A56B28F6023CF2B87D52038E212764A2004AD1B8D", 16)

d1 = Crypto.Util.number.inverse(65537, (p0 - 1)*(p7 - 1))
d2 = Crypto.Util.number.inverse(65537, (p1 - 1)*(p6 - 1))
d3 = Crypto.Util.number.inverse(65537, (p2 - 1)*(p5 - 1))
d4 = Crypto.Util.number.inverse(65537, (p3 - 1)*(p4 - 1))

cipherTexts = ["099c9fa162494d43b94faacf4c629d6e.bin", "66b074ab47cf3ee49120af85f3d0fab7.bin", "ad17dc07d229393faffc1761b12a6ede.bin", "ab8e31470744bd5cd410e7fea0b24443.bin"]
moduluses = [n1, n2, n3, n4]
privateKeys = [d1, d2, d3, d4]

with open(cipherTexts[2], "rb") as handle:
    c = handle.read()
c = int(binascii.hexlify(c), 16)
m = l2b(pow(c, privateKeys[0], moduluses[0]))
f = open("message0.txt", "w")
f.write(str(m))
f.close()

with open(cipherTexts[1], "rb") as handle:
    c = handle.read()
c = int(binascii.hexlify(c), 16)
m = l2b(pow(c, privateKeys[1], moduluses[1]))
f = open("message1.txt", "w")
f.write(str(m))
f.close()

with open(cipherTexts[3], "rb") as handle:
    c = handle.read()
c = int(binascii.hexlify(c), 16)
m = l2b(pow(c, privateKeys[2], moduluses[2]))
f = open("message2.txt", "w")
f.write(str(m))
f.close()

with open(cipherTexts[0], "rb") as handle:
    c = handle.read()
c = int(binascii.hexlify(c), 16)
m = l2b(pow(c, privateKeys[3], moduluses[3]))
f = open("message3.txt", "w")
f.write(str(m))
f.close()